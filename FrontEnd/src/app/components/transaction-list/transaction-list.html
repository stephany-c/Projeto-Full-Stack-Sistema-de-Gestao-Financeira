<div class="transaction-list-container">
    <div class="header-actions">
        <h2>Transações</h2>

    </div>

    <div class="filters">
        <div class="filter-group">
            <label>De:</label>
            <input type="date" [ngModel]="startDate()" (ngModelChange)="startDate.set($event); applyFilter()">
        </div>
        <div class="filter-group">
            <label>Até:</label>
            <input type="date" [ngModel]="endDate()" (ngModelChange)="endDate.set($event); applyFilter()">
        </div>
        <div class="filter-group">
            <label>Categoria:</label>
            <select [ngModel]="selectedCategoryId()" (ngModelChange)="selectedCategoryId.set($event); applyFilter()">
                <option value="">Todas</option>
                <option *ngFor="let cat of categories()" [value]="cat.id">{{ cat.name }}</option>
            </select>
        </div>
        <div class="filter-group">
            <label>Tipo:</label>
            <select [ngModel]="selectedType()" (ngModelChange)="selectedType.set($event); applyFilter()">
                <option value="">Todos</option>
                <option value="INCOME">Receitas</option>
                <option value="EXPENSE">Despesas</option>
            </select>
        </div>
        <div class="filter-group search">
            <label>Buscar:</label>
            <input type="text" [ngModel]="searchTerm()" (ngModelChange)="searchTerm.set($event); applyFilter()"
                placeholder="Descrição...">
        </div>
        <button class="btn-clear" (click)="clearFilter()">Limpar</button>
    </div>

    <table class="transaction-table">
        <thead>
            <tr>
                <th>Data</th>
                <th>Descrição</th>
                <th>Categoria</th>
                <th>Tipo</th>
                <th>Valor</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <ng-container *ngFor="let t of transactions()">
                <!-- View Mode -->
                <tr *ngIf="editingTransactionId() !== t.id" [ngClass]="t.type.toLowerCase()">
                    <td data-label="Data">{{ t.date | date:'dd/MM/yyyy' }}</td>
                    <td data-label="Descrição">{{ t.description }}</td>
                    <td data-label="Categoria">
                        <span class="category-badge">
                            {{ t.categoryName }}
                        </span>
                    </td>
                    <td data-label="Tipo">{{ t.type === 'INCOME' ? 'Receita' : 'Despesa' }}</td>
                    <td data-label="Valor">{{ t.amount | currency:'BRL' }}</td>
                    <td data-label="Ações">
                        <div class="actions">
                            <button class="btn-icon" (click)="startEdit(t)" title="Editar">
                                <i class="fa-solid fa-pen-to-square"></i>
                            </button>
                            <button class="btn-icon delete" (click)="deleteTransaction(t.id)" title="Excluir">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </div>
                    </td>
                </tr>

                <!-- Edit Mode -->
                <tr *ngIf="editingTransactionId() === t.id" class="edit-row">
                    <td data-label="Data">
                        <input type="date" [(ngModel)]="editData.date">
                    </td>
                    <td data-label="Descrição">
                        <input type="text" [(ngModel)]="editData.description">
                    </td>
                    <td data-label="Categoria">
                        <select [(ngModel)]="editData.categoryId">
                            <option *ngFor="let cat of categories()" [value]="cat.id">{{ cat.name }}</option>
                        </select>
                    </td>
                    <td data-label="Tipo">
                        <select [(ngModel)]="editData.type">
                            <option value="INCOME">Receita</option>
                            <option value="EXPENSE">Despesa</option>
                        </select>
                    </td>
                    <td data-label="Valor">
                        <input type="number" [(ngModel)]="editData.amount" step="0.01">
                    </td>
                    <td data-label="Ações">
                        <div class="actions">
                            <button class="btn-sm btn-success" (click)="saveEdit()" title="Salvar">
                                <i class="fa-solid fa-check"></i>
                            </button>
                            <button class="btn-sm btn-secondary" (click)="cancelEdit()" title="Cancelar">
                                <i class="fa-solid fa-xmark"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            </ng-container>
        </tbody>
    </table>

    <div class="pagination-footer" *ngIf="transactions().length > 0">
        <div class="pagination-info">
            Mostrando {{ transactions().length }} de {{ totalElements() }} resultados
        </div>
        <div class="pagination-controls">
            <button class="btn-page" [disabled]="currentPage() === 0" (click)="onPageChange(currentPage() - 1)">
                <i class="fa-solid fa-chevron-left"></i> Anterior
            </button>
            <span class="page-indicator">Página {{ currentPage() + 1 }} de {{ totalPages() }}</span>
            <button class="btn-page" [disabled]="currentPage() >= totalPages() - 1"
                (click)="onPageChange(currentPage() + 1)">
                Próximo <i class="fa-solid fa-chevron-right"></i>
            </button>
        </div>
        <div class="page-size-selector">
            <label>Itens por página:</label>
            <select [ngModel]="pageSize()" (ngModelChange)="onPageSizeChange($event)">
                <option [value]="5">5</option>
                <option [value]="10">10</option>
                <option [value]="20">20</option>
                <option [value]="50">50</option>
            </select>
        </div>
    </div>

    <p *ngIf="transactions().length === 0" class="empty-msg">Nenhuma transação encontrada.</p>
</div>